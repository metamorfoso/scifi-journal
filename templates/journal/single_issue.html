{% extends "nav.html" %}
{% from "_common.html" import thumbnail %}

{% block title %}Sponge - {{ issue.pretty_name }}{% endblock %}

{% block content %}
  <div id="contents-actions-container">
        {% if issue.bandcamp_album_id %}
            {% set height_of_bandcamp_plugin = [142] %}
                {% for story in stories %}
                    {% if story.bandcamp_track_id %}
                        {% if height_of_bandcamp_plugin.append(height_of_bandcamp_plugin.pop() + 33) %}
                        {% endif %}
                    {% endif %}
                {% endfor %}
            {% set height_of_bandcamp_plugin = height_of_bandcamp_plugin.pop()| string + 'px' %}
            <div style="height:calc({{height_of_bandcamp_plugin}} + 1rem + 4px)" class="tab">
                <button class="active" id="contents-tab" onclick="openTab('contents')"><img class="tab-icon" src="{{static('images/content_icon.png')}}"/></button>
                <button class="inactive" id="audio-tab" onclick="openTab('audio')"><img class="tab-icon" src="{{static('images/player_icon.png')}}"/></button>
            </div>
            <div class="audio-player" id="desktop">
                <iframe style="border: 0; width: 100%; height: {{height_of_bandcamp_plugin}}" src="https://bandcamp.com/EmbeddedPlayer/album={{issue.bandcamp_album_id}}/size=large/bgcol=ffffff/linkcol=3f1ca2/artwork=small/transparent=true/"><a href="{{issue.bandcamp_album_url}}">Sponge: {{issue.pretty_name}}</a></iframe>
            </div>
        {% endif %}
        <div class="panel-outer contents-panel">
          <div class="panel-inner">
            <div style="top:0px" class="panel-content">
              <ol class="contents-list">
                {% for story in stories %}
                  <li>
                      <a href="{{ story.get_absolute_url() }}">
                          <div class="story-title">
                            <i>{{ story }}</i>
                          </div>
                      </a>
                      {% if story.author.url %}
                      <a href="{{story.author.url}}">
                          <div class="story-author">
                            {{ story.author }}
                          </div>
                      </a>
                      {% else %}
                        <div class="story-author">
                            {{ story.author }}
                        </div>
                      {% endif %}
                  </li>
                {% endfor %}
              </ol>

              <div class="download-btn-wrapper">
                {#  Only make download buttons active if there are files to download  #}
                {%- if issue.pdf %}
                  {#-  -#}
                  <a href="{{ url('download_issue', issue.number, 'pdf') }}"
                  ><div class="download edge pdf nodrag"><span class="button-text">PDF</span></div></a>
                  {#-  -#}
                {% else -%}
                  <div class="download edge greyedout nodrag"><span class="button-text">PDF</span></div>
                  {#-  -#}
                {% endif -%}
                {% if issue.mobi %}
                  {#-  -#}
                  <a href="{{ url('download_issue', issue.number, 'mobi') }}"
                  ><div class="download centre mobi nodrag"><span class="button-text">MOBI</span></div></a>
                  {#-  -#}
                {% else -%}
                  <div class="download centre greyedout nodrag"><span class="button-text">MOBI</span></div>
                  {#-  -#}
                {% endif -%}
                {%- if issue.epub %}{#-  -#}
                  <a href="{{ url('download_issue', issue.number, 'epub') }}"
                  ><div class="download edge epub nodrag"><span class="button-text">EPUB</span></div></a>
                  {#-  -#}
                {% else -%}
                  <div class="download edge greyedout nodrag"><span class="button-text">EPUB</span></div>
                  {#-  -#}
                {% endif -%}
                </div>
            </div>
          </div>
        </div>
    </div>

  <div class="cover-panel">
    <p style="margin-bottom: 1.8rem" class="panel-heading">{{ issue.pretty_name }}</p>
      {% if issue.pdf %}
        <div id="issue-pdf"></div>
      {% endif %}

      {% if cover %}
        <div id="issue-cover">{{ thumbnail(cover.cover_image, "320x464") }}</div>
      {% else %}
        <div id="issue-cover" class="no-image"></div>
      {% endif %}
  </div>

{% endblock %}

{% block script %}
{% if issue.pdf %}
  <script>
    if(PDFObject.supportsPDFs === false){
       $("#issue-pdf").css("display","none");
    }

    PDFObject.embed("{{issue.pdf.url}}", "#issue-pdf", {pdfOpenParams: { view: 'FitW', scrollbar: '1', toolbar: '0', statusbar: '1', messages: '0', navpanes: '1' }});
  </script>
{% endif %}
{% endblock %}
